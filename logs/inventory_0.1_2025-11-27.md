# 0.1 既存資産の棚卸し結果 (2025-11-27)

## 概要

TODO.md の「0.1 既存資産の棚卸し」に従い、以下を確認した。

---

## 1. フェーズ0-0データの確認

### 1.1 ΔE/adv実測値

| 状態 | 結果 |
|------|------|
| **確認済み** | OK |

**ファイル**: `docs/フェーズ1/results/delta_energy_row1120_row1123_off.md`

| Interval | Trials | ΔE/adv Mean (mJ) | ΔE/adv Std |
|----------|--------|------------------|------------|
| 100ms | 10 | 2.257 | ±0.162 |
| 500ms | 10 | 9.760 | ±0.339 |
| 1000ms | 4 | 19.661 | ±0.134 |
| 2000ms | 2 | 39.482 | ±0.063 |

**データソース**:
- ON: `data/実験データ/研究室/row_1120/TX`
- OFF: `data/実験データ/研究室/row_1123_off/TX`

### 1.2 P_off_mean = 22.106 mW

| 状態 | 結果 |
|------|------|
| **確認済み** | OK |

**ファイル**: `docs/フェーズ1/results/delta_energy_row1120_row1123_off.md` (Line 9)
- OFF trials: 7/7 kept (MAD3 outlier filter適用)
- OFF mean E_total_mJ: 1326.381 mJ

### 1.3 PDR実測値 (p_d ≈ 0.85)

| 状態 | 結果 |
|------|------|
| **確認済み** | OK |

**ファイル**: `docs/フェーズ1/results/pdr_row1120_txsd_rx.md`

| Interval | Trials | PDR_ms Mean | PDR_ms Std |
|----------|--------|-------------|------------|
| 100ms | 10 | 0.814 | ±0.021 |
| 500ms | 10 | **0.845** | ±0.018 |
| 1000ms | 4 | 0.872 | ±0.009 |
| 2000ms | 2 | 0.876 | ±0.008 |

**結論**: p_d ≈ 0.85 は500ms条件の実測値として妥当。

---

## 2. HARモデル（A0）の確認

### 2.1 TFLite int8モデル

| 状態 | 結果 |
|------|------|
| **エクスポート済み** | OK |

**ファイル**: `har/004/export/acc_v1_keras/phase0-1-acc.v1.int8.tflite`
- サイズ: **92,768 bytes (90.6 KB)**
- SHA256: `e1c3ff0042badac5dd9bb478a17fac79991736c813143b45e5cb981d9db68610`
- 入力形状: [1, 100, 3] (2秒窓@50Hz, 3軸加速度)

**注意**: TODO記載の「90.6KB」と一致。ただし目標22KBは未達。

### 2.2 校正パラメータ

| 状態 | 結果 |
|------|------|
| **確定済み** | OK |

**ファイル**: `har/001/docs/A0_acc_v1_baseline_summary.md`

| パラメータ | 値 | 備考 |
|------------|-----|------|
| Temperature (T) | **0.7443** | valロジット温度スケーリング |
| τ (Unknown閾値) | **0.66** | Unknown率 5-15%内に調整 |
| ECE | 0.0924 | T適用後 |
| Unknown率 | 4.35% | τ適用後 |

**注意**: TODOに記載の「T=0.7443, τ=0.66」と一致。

### 2.3 CCS閾値

| 状態 | 結果 |
|------|------|
| **設定済み（デフォルト）** | 要再調整 |

| パラメータ | 値 | 備考 |
|------------|-----|------|
| θ_low | **0.40** | デフォルト値 |
| θ_high | **0.70** | デフォルト値 |

**注意**:
- `har/004/docs/decision_log_2025-11-26.md` に記載:「θ_low/θ_high はバリデーションで再キャリブ（デフォルト 0.40/0.70 は置き換え可）」
- TFLite出力ベースでの再キャリブが必要

### 2.4 モデル性能

| 指標 | 値 |
|------|-----|
| 12クラス BAcc | 0.828 |
| 4クラス BAcc | 0.960 |
| Macro F1 (12c) | 0.747 |
| PT↔TFLite argmax一致 | 0.98 |
| PT↔TFLite max_prob MAE | 0.0277 |

---

## 3. mHealthデータセットの確認

### 3.1 生データへのアクセス

| 状態 | 結果 |
|------|------|
| **アクセス可能** | OK |

**パス**: `data/MHEALTHDATASET/`

| ファイル | サイズ |
|----------|--------|
| mHealth_subject1.log | 30.0 MB |
| mHealth_subject2.log | 24.4 MB |
| ... | ... |
| mHealth_subject10.log | 18.5 MB |

### 3.2 被験者数・セッション数・活動ラベル

| 項目 | 値 |
|------|-----|
| 被験者数 | **10名** |
| サンプリングレート | 50 Hz |
| センサー位置 | 胸・左足首・右前腕 |
| 使用センサー（本研究） | **胸3軸加速度のみ** |

**活動ラベル（12クラス）**:
| L# | 活動 | 時間/回数 |
|----|------|-----------|
| L1 | Standing still | 1 min |
| L2 | Sitting and relaxing | 1 min |
| L3 | Lying down | 1 min |
| L4 | Walking | 1 min |
| L5 | Climbing stairs | 1 min |
| L6 | Waist bends forward | 20x |
| L7 | Frontal elevation of arms | 20x |
| L8 | Knees bending (crouching) | 20x |
| L9 | Cycling | 1 min |
| L10 | Jogging | 1 min |
| L11 | Running | 1 min |
| L12 | Jump front & back | 20x |

### 3.3 データ前処理パイプライン

| 状態 | 結果 |
|------|------|
| **動作確認済み** | OK |

**前処理済みデータ**: `har/001/data_processed/subject{01-10}.npz`

| 被験者 | 窓数 |
|--------|------|
| subject01 | 694 |
| subject02 | 704 |
| subject03 | 698 |
| subject04 | 697 |
| subject05 | 669 |
| subject06 | 634 |
| subject07 | 670 |
| subject08 | 659 |
| subject09 | 677 |
| subject10 | 666 |
| **合計** | **6,768** |

**npzファイル構造**:
- `X`: 窓データ [N, 100, 3] (100サンプル×3軸)
- `y12`: 12クラスラベル [N]
- `y4`: 4クラスラベル [N] (Locomotion/Transition/Stationary)
- `spans`: 元データ位置
- `preproc_hash`: 前処理ハッシュ

---

## 4. 棚卸し結果サマリ

| 項目 | 状態 | 備考 |
|------|------|------|
| ΔE/adv実測値 (100/500/1000/2000ms) | **OK** | 使用可能 |
| P_off_mean = 22.106 mW | **OK** | 使用可能 |
| PDR (p_d ≈ 0.85) | **OK** | 500ms条件 |
| TFLite int8モデル | **OK** | 90.6KB |
| 校正パラメータ (T=0.7443, τ=0.66) | **OK** | 確定済み |
| θ_low=0.40, θ_high=0.70 | **要調整** | デフォルト値、再キャリブ推奨 |
| mHealth生データ | **OK** | アクセス可能 |
| 前処理パイプライン | **OK** | 動作確認済み |

---

## 5. 次のアクション

1. ~~**θ_low/θ_high の再キャリブ**~~: **スキップ**（下記判断参照）
2. **TFLiteサイズ削減**: 90.6KB→22KB目標への軽量化検討（A_tiny）→ Phase 1実験後に検討
3. **0.2 ハードウェア準備状況の確認**: ESP32, PPK-II, Android端末の確認

---

## 6. 判断ログ

### 2025-11-27: θ_low/θ_high 再キャリブについて

**判断**: デフォルト値（0.40/0.70）で進める（選択肢B）

**理由**:
- 再キャリブに時間がかかる
- デフォルト値でも「CCS制御 vs 固定間隔」の比較は成立する
- 閾値の最適化自体がSafe Banditの役割なので、Phase 1の決め打ちルールでは粗い閾値でもOK
- 結果を見て必要なら調整

---

*Last updated: 2025-11-27*
