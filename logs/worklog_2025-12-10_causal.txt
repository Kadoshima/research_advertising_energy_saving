2025-12-10
- A-1/A-2: read Mode_C_2_シミュレート_causal/sim_timeline_metrics_causal_agg.csv → CCS_causal acc=0.9160, TL_mean=6.81s, Pout(1s/2s/3s)=0.323/0.091/0.088; positioned between FIXED_1000(0.935,5.26s,0.064) and FIXED_2000(0.870,9.40s,0.492), with FIXED_500 as upper-QoS reference (acc=0.972, TL=2.92s, Pout1s=0.036).
- A-2: from manifest_stress_causal.json interval_frac mean {100ms:0.2086, 500ms:0.2033, 2000ms:0.5881}, E[T_adv]≈1298.7ms. Using Mode_C_2_03 E_per_adv_uJ (100:19872.3, 500:96739.4, 1000:197036.0, 2000:394849.8) → weighted E/adv≈256,025 μJ (rel vs 100ms=12.88x, vs 500ms=2.65x, vs 2000ms=0.65x); weighted power≈196.9 mW (~0.99x vs FIXED_100, ~1.02x vs FIXED_500, ~1.00x vs FIXED_1000/2000).
- docs/TODO.md: marked A-1/A-2 as done, added the above QoS/energy numbers, kept A-3 frozen parameters (CCS=0.7*(1-U)+0.3*S; S_causal=time_since_last_transition/5s clip; U_causal=1-S+N(0,0.05^2); thresholds 0.30/0.70 -> 100/500/2000ms; no hysteresis for stress case).
- A-4: PDR<1 sweep (0.95/0.9) → Mode_C_2_シミュレート_causal/sim_timeline_metrics_causal_pdr_sweep.csv. Ranking stable: CCS_causal remains between FIXED_1000 and 2000 (PDR=0.95: CCS acc≈0.915 TL≈0.69s Pout1s≈0.30; FIXED_500 acc≈0.968 TL≈0.33s Pout1s=0; FIXED_2000 acc≈0.860 TL≈1.21s Pout1s≈0.55). TODO.md A-4 checked.
- B-1 prep: added scripts/analyze_stress_causal_real.py (RX+TXSD→ per-trial PDR, Pout, TL_mean/p95, E_total/E_per_adv/avg_power; supports truth map; outputs CSV summary).
- B-2 prep: added scripts/plot_stress_causal_real_vs_sim.py (aggregates real summary, reads sim agg, plots Pout(1s) bars real/sim + relative energy line vs ref mode).
- Firmware prep: duplicated 1202 modeC2prime code into new versioned path esp32_firmware/1210:
  - RX: esp32_firmware/1210/modeC2prime_rx/RX_ModeC2prime_1210/RX_ModeC2prime_1210.ino (from 1202 RX)
  - TX: esp32_firmware/1210/modeC2prime_tx/{TX_ModeC2prime_1210.ino, TX_ModeC2prime_1210_flash/*.ino, labels_all.h, labels_subjects/*}
- Firmware tweaks: bumped version strings/comments to 1210 (RX FW_TAG/boot log; TX flash banner; TX comment).
- TX flash sweep tweaks: esp32_firmware/1210/modeC2prime_tx/TX_ModeC2prime_1210_flash/TX_ModeC2prime_1210_flash.ino
  - clarified schedule comment (subjects × intervals 100/500/1000/2000 × repeats), added <cmath>
  - added SUBJECT_START/SUBJECT_END knobs (default all subjects)
  - start/end serial prints include stepCount/len; FW banner notes fixed-intervals sweep
- TXSD: created esp32_firmware/1210/modeC2prime_txsd/TXSD_ModeC2prime_1210.ino from TXSD_1201
  - FW banner/meta updated, pin comments aligned (SYNC=26 from TX GPIO25, TICK=33), SUBJECT_ID default set to modeC2prime_1210, SYNC gate + optional TICK end logic retained.
- TXSD/RX run (fixed-interval sweep auto):
  - Completed TXSD trials 010–019 (~10 trials): adv_counts ≈ {100ms: 6345/6344/6343; 500ms: 1270/1269/1269; 1000ms: 635/635; 2000ms: 317/317}. Each trial ~634s, mean power ~198–204 mW, E_total ~125–132 J. PDR calc pending (RX dup filter off; needs uniq postproc).
  - RX logs rx_trial_003–013 aligned with TXSD times; buf_overflow=0, rate ≈8.3 Hz (dup-on).
  - Remaining time if full 10 subjects: ~30 trials left → ~5.3h; if stop after subject3 (two more trials), ~20 min.
- Data commit (0d34217): added RX logs rx_trial_003–014 and TXSD logs trial_010_on–021_on under data/1210_modeC2prime_fixed/.
  - Interval mapping by adv_count: 100ms → 010/014/018; 500ms → 011/015/019; 1000ms → 012/016/020; 2000ms → 013/017/021.
- Analysis run: generated results/stress_causal_real_summary.csv using manifest (rx↔txsd mapping).
  - PDR (uniq seq): 100ms ≈0.83–0.84; 500/1000/2000ms ≈1.0.
  - E_per_adv_uJ: ~20.1k–20.8k (100ms), ~99.0k–99.6k (500ms), ~197.9k–198.7k (1000ms), ~396.5k–396.9k (2000ms).
  - TL/Pout remain 0.0 because truth_file not specified in manifest; add truth mapping to compute TL/Pout.
- Truth export + TL/Pout計算:
  - 1202 labels_all.h を CSV 化 (scripts/export_labels_all_to_csv.py) → data/1210_modeC2prime_fixed/truth/subject01..10.csv
  - manifest に truth_file 列を追加（subject01→trial_003–006, subject02→007–010, subject03→011–014）
  - 再解析で TL/Pout 取得: results/stress_causal_real_summary.csv 更新
    - subj01: tl_mean≈0.05–0.56s, pout<=0.25; subj02: tl_mean≈10s, pout=0.167 (ラベル滞留区間が長いため)
    - PDR/E_per_adv は前回同等（100ms≈0.83, 500/1000/2000≈1.0; E_per_adv 既報）
- Truth clip fix: subject02 に TX再生範囲外の遷移あり (idx=6410>6352)。export を EFFECTIVE_LEN=6352 にクリップするよう修正し再出力、再解析。
  - 全trialの TL/Pout 正常化（subj02 の tl_mean≈10s→~1s 台、pout_1s=0 except 2000ms=0.25）。PDR/E_per_adv は不変。
  - scripts/export_labels_all_to_csv.py に seq[:6352] clip を追加。

[2025-12-11 11:33 JST] Note: stress auto-sweep run aborted early (Nadv~77); user says alternate dataset available and will use that instead. Awaiting path/manifest for analysis.
[2025-12-11 11:35 JST] User opted to use alternate stress fixed dataset (path/manifest TBD). Next: await dataset path + RX/TXSD mapping, then run scripts/analyze_stress_causal_real.py with manifest and optional plots.
[2025-12-11 11:45 JST] Cleaned data/1211_modeC2prime_stress_fixed (kept trial_001-004). Renamed TX logs to align with RX IDs. Added manifest.csv mapping trials to stress_causal_S1 truth. Ran analyze_stress_causal_real.py -> results/stress_causal_real_summary_1211_stress100.csv (100ms stress; pdr~0.80-0.83, tl_mean~6.12s, pout_1s=0.05, E_per_adv~20.0-20.4k uJ).
[2025-12-11 11:47 JST] Analysis summary (stress 100ms, S1): PDR 0.80-0.83, TL_mean ~6.12s, TL_p95 ~42s, Pout_1s=0.05, E_per_adv ~20.0-20.4k uJ, avg_power ~200 mW. Files: data/1211_modeC2prime_stress_fixed/{RX,TX,manifest.csv}, results/stress_causal_real_summary_1211_stress100.csv.
[2025-12-11 12:05 JST] Restored stress fixed logs (rx 008-012, txsd 009-013). Renamed TXSD for alignment (009_on_short kept, 010→009, 011→010, 012→011, 013→012). Updated manifest (S1@100: 001-004,009; S1@2000:010; S4@100:011; S4@2000:012). Re-ran analyze_stress_causal_real.py -> results/stress_causal_real_summary_1211_stress.csv.
[2025-12-11 12:12 JST] Removed trial_002_on.csv (truncated) and rx_trial_002.csv. Updated manifest to 001/003/004/009 (S1-100ms), 010 (S1-2000ms), 011 (S4-100ms), 012 (S4-2000ms). Re-ran analyze_stress_causal_real.py -> results/stress_causal_real_summary_1211_stress.csv (no 002 warnings).
[2025-12-11 12:18 JST] Updated TX_ModeC2prime_1210_flash_stress.ino: sweep intervals now {100,500,1000,2000} for stress S1/S4, REPEAT=1. Ready to flash for full 4-interval run.
[2025-12-11 12:30 JST] Note: User analysis recap: data/1211_modeC2prime_stress_fixed cleaned well; S1/S4×100/2000 manifest OK; S1 100ms shows PDR≈0.81, TL_mean≈6s, Pout1s=0.05, E_per_adv≈20kµJ (energy model consistent, QoS hit likely due to PDR~0.8/outliers); TL_mean driven by rare long gaps—use Pout/TL_p95 as primary QoS; next suggested steps: (1) manifest to just S1/S4 100/2000 (done), make 4-row table (PDR, Pout1s, TL_mean/p95, E_per_adv, relative power), (2) overlay vs sim agg to check ordering/scale.
[2025-12-11 17:26 JST] Stress flash auto-sweep (full intervals) complete: trials 18-25 & rx 17-24 captured. Mapping: S1 100/500/1000/2000 -> (rx17/18/19/20 ↔ txsd18/19/20/21); S4 100/500/1000/2000 -> (rx21/22/23/24 ↔ txsd22/23/24/25). Trial17/rx16 was short-run (discard). All TXSD parse_drop=0, RX overflow=0, adv_counts {100:~6347, 500:~1270, 1000:~635, 2000:~317}. Pending: place data into data/1211_modeC2prime_stress_fixed and run analyze with manifest.
[2025-12-11 17:40 JST] Added manifest for full stress sweep (S1/S4 x 100/500/1000/2000) at data/1211_modeC2prime_stress_fixed/full/manifest.csv. Ran analyze_stress_causal_real.py -> results/stress_causal_real_summary_1211_stress_full.csv (trials 18-25). Note: trial16/17 skipped (missing TXSD). PDR uses rx_unique/adv_count and appears low; can switch to rx_count if needed.
[2025-12-12 12:00 JST] Updated scripts/analyze_stress_causal_real.py to output pdr_raw (rx_count/adv) and pdr_unique (rx_unique/adv). Re-ran full stress sweep manifest -> results/stress_causal_real_summary_1211_stress_full.csv updated. Note: pdr_raw shows large values for 500/1000/2000 due to duplicate RX entries; interpretation needed (likely use pdr_unique as QoS).
[2025-12-12 12:25 JST] TX_ModeC2prime_1210_flash_stress.ino updated for 2000ms-only sweep, REPEAT=2 (S1,S4 each run twice).
[2025-12-12 12:45 JST] Re-flashed 2000ms-only (REPEAT=2) and captured S1/S4 runs: TX 030-033, RX 030-032 (029 missing TXSD). Manifest at data/1211_modeC2prime_stress_fixed/harf2000/manifest.csv. analyze_stress_causal_real.py -> results/stress_causal_real_summary_1211_stress_2000_runs.csv (pdr_raw/pdr_unique ~0.88, Pout1s ~0.71-0.98, TL_mean ~12.5-54s). Need to integrate S4 2000ms into main full dataset; still missing RX for trial033.
[2025-12-12 12:55 JST] TX_ModeC2prime_1210_flash_stress.ino updated: SESS_LIST={S4 only}, INTERVALS={2000}, REPEAT=1 (single S4@2000 retake).
[2025-12-12 12:57 JST] Reminder: build now set to S4-only 2000ms single run (REPEAT=1). After capture, place RX/TXSD into full/ and map to trial_025/rx_trial_025 for manifest.
[2025-12-12 13:05 JST] Added S4@2000 retake: rx_trial_035/trial_038_on copied to full as rx_trial_025/trial_025_on. Manifest refreshed. Re-ran analyze -> results/stress_causal_real_summary_1211_stress_full.csv and modes.csv now 8 rows. PDR clamped to adv_count; S4 2000ms now pdr_unique≈0.86, Pout1s≈0.67, TL_mean≈16.6s, E_per_adv≈359kµJ, avg_power≈180mW.
[2025-12-12 13:15 JST] Docs update: added data/1211_modeC2prime_stress_fixed/README.md (S1/S4 fixed 100/500/1000/2000 summary, manifest, key metrics). Updated docs/TODO.md with progress memo (stress fixed full dataset done; PDR unique guidance; next CCS/self-UCB).
[2025-12-12 13:16 JST] Docs reflected: added stress fixed README (data/1211_modeC2prime_stress_fixed/README.md) and TODO progress memo (stress fixed full set done; pdr_unique guidance; next CCS/self-UCB).
[2025-12-12 13:20 JST] README.md: added note on latest stress fixed dataset (S1/S4 x 100/500/1000/2000) with manifest/results/summary paths.
[2025-12-12 13:25 JST] Integrated S1@2000 retakes (trial_030/031) into full manifest; removed old 021. Re-ran analysis -> results/stress_causal_real_summary_1211_stress_full.csv (9 rows) and per-trial modes + new agg summary (results/stress_causal_real_summary_1211_stress_modes.csv, ..._agg.csv). Updated data/1211_modeC2prime_stress_fixed/README.md to reflect retakes and metrics; noted RX FW includes 1202 logs. README root updated earlier.
[2025-12-12 13:35 JST] Added docs/metrics_definition.md (pdr_raw/unique definitions, TL/Pout, 2000ms Pout≥0.5 note, EFFECTIVE_LEN, file references).
[2025-12-12 13:36 JST] Metrics doc added (docs/metrics_definition.md: pdr_raw/unique, TL/Pout, Pout1s≥0.5 @2000ms, EFFECTIVE_LEN, file refs).
[2025-12-12 13:40 JST] Updated README.md to link metrics_definition.md; updated docs/TODO.md progress memo to mention metrics_definition.md.
[2025-12-12 13:50 JST] RX_ModeC2prime_1210: increased scan duty (interval 100ms, window 90ms, passive) to improve coverage at 100ms adv. No other logic changes.
[2025-12-12 13:55 JST] TX_ModeC2prime_1210_flash_stress.ino: retargeted to S1 only, 100ms only, REPEAT=1 (single trial). RX scan duty already increased earlier (interval=100, window=90).
[2025-12-12 14:05 JST] Retest S1@100ms with increased scan duty (interval=100, window=90): trial_044_on/rx_trial_040 -> pdr_unique=0.8299, Pout1s=0.0667, TL_mean=8.38s, E_per_adv=20205.6 uJ. Manifest used in 1s100ms folder.
[2025-12-12 14:20 JST] TX_ModeC2prime_1210_flash_stress.ino reset to full sweep: S1/S4 x {100,500,1000,2000}, REPEAT=1 (8 trials total). RX scan duty already set to interval=100ms, window=90ms. Ready to retake full set under scan90.
[2025-12-12 14:30 JST] Archived scan50 results: renamed stress_causal_real_summary_1211_stress_full/modes/agg/agg_enriched -> *_scan50.csv. Awaiting scan90 full sweep data; will produce new *_scan90 files.
[2025-12-12 14:32 JST] Docs: data/1211 README updated to note scan50 archived (*_scan50) and scan90 forthcoming; root README now points to *_scan50 files for current stress fixed set.
[2025-12-12 14:35 JST] Cleaned manifest for trial_040 (scan90 S1@100); renamed TX to trial_040_on. Re-ran analysis and regenerated *_scan50 outputs (full/modes/agg/agg_enriched). Pending: scan90 full sweep data to produce *_scan90.
