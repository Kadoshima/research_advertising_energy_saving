# CCS閾値調整ログ (2025-11-27)

## 変更内容

### 閾値変更

| パラメータ | 変更前 | 変更後 |
|------------|--------|--------|
| θ_high | 0.70 | **0.90** |
| θ_low | 0.40 | **0.80** |
| hysteresis | 0.05 | 0.05 (変更なし) |
| min_stay | 2.0s | 2.0s (変更なし) |

### 写像ルール

| CCS範囲 | T_adv | 意味 |
|---------|-------|------|
| CCS < 0.80 | 100ms | 不確実 → 高応答 |
| 0.80 ≤ CCS < 0.90 | 500ms | 中間 |
| CCS ≥ 0.90 | 2000ms | 確信あり → 省電力 |

---

## 変更理由

mHealthデータのCCS分布が高め（平均0.84-0.93）であり、元の閾値（θ_high=0.70, θ_low=0.40）では：

- ほぼ全てのサンプルが2000ms区間に入る
- 遷移がほとんど発生しない（5-59回/セッション）
- 固定間隔との差が見えにくい

閾値を上げることで：

- 3つの間隔が適度に出現
- 遷移回数が増加（13-70回/セッション）
- CCS制御の効果が可視化できる

---

## 変更前後の比較

### 変更前（θ_high=0.70, θ_low=0.40）

| Subject | CCS Mean | Trans | 100ms | 500ms | 2000ms |
|---------|----------|-------|-------|-------|--------|
| 01 | 0.839 | 59 | 2.9% | 15.3% | 81.8% |
| 08 | 0.872 | 40 | 2.6% | 17.3% | 80.1% |

### 変更後（θ_high=0.90, θ_low=0.80）

| Subject | CCS Mean | Trans | 100ms | 500ms | 2000ms |
|---------|----------|-------|-------|-------|--------|
| 01 | 0.839 | 85 | 32.4% | 10.4% | 57.2% |
| 08 | 0.872 | 32 | 24.9% | 4.2% | 70.9% |

---

## 影響範囲

### 変更ファイル

- `scripts/generate_ccs_sequences.py`: THETA_HIGH, THETA_LOW定数

### 再生成したデータ

- `data/ccs_sequences/subject{01-10}_ccs.csv`
- `data/ccs_sequences/generation_summary.json`
- `data/esp32_sessions/session_{01-10}.csv`
- `data/esp32_sessions/session_manifest.json`
- `data/esp32_sessions/session_selection_report.md`

---

## 注意事項

1. **この閾値はmHealthデータに最適化**されたもの。実機実験時のCCS分布が異なる場合、再調整が必要。

2. **Phase 2（Safe Bandit）では閾値を自動学習**するため、この閾値はPhase 1の暫定値として扱う。

3. **ドキュメントとの整合性**: `docs/フェーズ1/要件定義.md` には旧閾値（0.40/0.70）が記載されている。実験結果に基づき、ドキュメントを更新するか、「mHealthシミュレーション用に調整」と注記する。

---

*Last updated: 2025-11-27*
