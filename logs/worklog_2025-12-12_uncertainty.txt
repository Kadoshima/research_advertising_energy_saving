2025-12-12
- [18:45 JST] mHealth合成セッション v1.0 再生成（3種修正反映）：U正規化を3クラスlog(3)に変更、4クラス集約をTFLite出力(1..12)準拠に修正、品質指標をsummary.jsonに追加。3 seeds×3本を再生成（duration≈870.5s、mean_U≈0.247-0.276、CCS≈0.192-0.212）。成果物: data/mhealth_synthetic_sessions_v1/{summary.json, sessions/*}。README更新済み。
- [19:00 JST] オフライン方策比較を実施: scripts/build_policy_table.py 追加。評価セット: data/mhealth_synthetic_sessions_v1/sessions (mask_eval_window==1のみ)、固定メトリクス: scan90 agg v4。出力: results/mhealth_policy_eval/policy_table.md（Fixed 100/500/1000/2000, U-only, CCS-only, U+CCS）。U+CCSシェア=100:0.471/500:0.092/2000:0.437、期待値 pdr_unique≈0.909, pout_1s≈0.166, tl_mean≈10.49s, E_per_adv≈193,348 µJ, avg_power≈200.48 mW。CCS-onlyでは pdr_unique≈0.946, pout_1s≈0.152, tl_mean≈9.66s, E_per_adv≈259,444 µJ。
- [19:10 JST] 表の可視化: scripts/plot_policy_table.py 追加し、policy_table.md をバーチャート化（pdr_unique / pout_1s / tl_mean_s / E_per_adv）。出力: results/mhealth_policy_eval/policy_table.png（matplotlib使用、フォントキャッシュ警告ありだが生成完了）。
- [19:30 JST] 閾値・ヒステリシスのグリッドスイープ: scripts/sweep_policy_pareto.py 追加。グリッド 3×3×3×3×3=243通り（u_high>u_mid, c_high>c_mid）。出力: results/mhealth_policy_eval/pareto_front/{pareto_sweep.csv, pareto_summary.md}。δ=0.1 は該当なし、δ=0.2 で最良クラス: (u_mid=0.10, u_high=0.25, c_mid=0.10, c_high=0.25, hyst=0.08) → pout_1s≈0.197, E_per_adv≈33.1k µJ, share100≈0.891, share2000≈0.014, switch_rate≈0.023。
- [19:50 JST] スイープ評価を avg_power 最適化に切替: sweep_policy_pareto.py を avg_power_mW 軸でのソート/サマリに修正し再実行。δ=0.1 なし、δ=0.2 上位は avg_power ≈200.38–200.39 mW（share100≈0.40–0.46, share2000≈0.52–0.58）。可視化を更新: plot_pareto_sweep.py を avg_power vs pout_1s 散布＋上位10 stacked barに変更、出力 results/mhealth_policy_eval/pareto_front/pareto_plots.png を再生成。README/summary 反映済み。
- [20:05 JST] v2（power軸）の出力を別ディレクトリに作成: results/mhealth_policy_eval/pareto_front_v2/{pareto_sweep.csv, pareto_summary.md, pareto_plots.png}。plot_pareto_sweep.py を CSV_PATH/OUT_PATH/METRIC 環境変数でパス切替し、METRIC=power で生成。δ=0.1なし、δ=0.2は avg_power≈200.38–200.39 mW、share100≈0.40–0.46、switch_rate≈0.054–0.066。
- [19:40 JST] スイープ結果を可視化: scripts/plot_pareto_sweep.py 追加（散布図 + δ=0.2 上位10のstacked bar）。出力: results/mhealth_policy_eval/pareto_front/pareto_plots.png（matplotlibフォント警告あり）。pareto_summary.md に δ=0.1該当なしを明記。
- [20:25 JST] Pareto v3 作成（adv_rate追加・power軸継続）: sweep_policy_pareto.py に adv_rate/mean_interval_ms 計算を追加し、出力先を pareto_front_v3 に分離。243グリッドを再評価（METRIC=power）。δ=0.1は依然なし、δ=0.2の上位は avg_power≈200.38–200.39 mW とほぼフラットだが share100≈0.40–0.46 / share2000≈0.52–0.58 まで拡張。adv_rate ≈4.4–5.0 adv/s（固定100ms比で約50–56%減）。成果物: results/mhealth_policy_eval/pareto_front_v3/{pareto_sweep.csv, pareto_summary.md, pareto_plots.png, README.md}。補足可視化: plot_pareto_sweep_multi.py 追加（pout vs avg_power / adv_rate 散布図）。
- [20:40 JST] Pareto v3 サマリ軸を再構成: pareto_summary.md をδ=0.2内での3視点(adv_rate最小/ switch_rate最小/ pout_1s最小 各Top10)に更新。δ=0.1は該当なしを明記。対象CSV: results/mhealth_policy_eval/pareto_front_v3/pareto_sweep.csv。
- [21:15 JST] Step C 実装: eval_policy_offline/sweep_policy_pareto に stable/transition 切替（truth遷移 or CCS_ema>=0.3）を追加し、S1→stable / S4→transition で期待値合成する context_mixing を実装。shares_ctx_weighted を用いて全窓比率で線形合成するよう修正。新スイープ v4 を power軸・context_mixing で実行し成果物生成: results/mhealth_policy_eval/pareto_front_v4_context/{pareto_sweep.csv, pareto_summary.md, pareto_plots.png, README.md}。δ=0.1依然なし、δ=0.2で pout_1s≈0.126–0.129、share100≈0.40–0.46、share2000≈0.52–0.58、avg_power≈200.48–200.50 mW（フラット）。
- [21:35 JST] 方針確定の記録: A/B/C解析結果を踏まえ、READMEに現状の結論と次アクションを追記。結論: δ=0.1はS4固定メトリクス(pout_1s≈0.177)の下限で不可能。コンテキスト混合でpout≈0.12台まで改善するが、固定計測がsleep無しのためavg_powerはフラット。意思決定: 省電力を主軸にし、睡眠可能設計を評価スコープに含める。次ステップ: (1) 固定100/2000msでsleep有無を計測し“寝ている”証拠を取得、(2) sleepあり固定テーブルを作成しeval/sweepを差し替え、(3) 実機はP_event/P_bal/P_stableとFixed100/2000の4条件で最小検証。ログ目的: 意思決定の根拠と次アクションを残す。
