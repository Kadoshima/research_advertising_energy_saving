# Phase0-1 作業ログ (2025-11-26)

## TinyMLアーティファクト v1 固定までの作業
- 環境: Python 3.12 (.venv312) で PyTorch→Keras 変換スクリプトを作成・実行。変換専用の Python 3.10 (.venv310/.venv310lite) も作成して依存確認。
- ベースライン: 3軸版 acc.v1 (config: `har/004/configs/phase0-1.acc.v1.yaml`, ckpt: `har/004/runs/phase0-1-acc/fold90/best_model.pth`, model_id sha256=`d9fcb1364f888c98e0b61f034519f5e5d794e3e5574cb275b6e4c0083024fd30`).
- Keras再実装 & 重み移植: `har/004/tools/convert_acc_v1_keras_tflite.py` で PyTorch state_dict を Keras DS-CNN に移植し、SavedModel/TFLite を出力。
- PTQ代表データ: `har/004/export/acc_v1/rep_data.npy`（2000窓, 100x3, float32）を representative_dataset に使用。
- 生成成果物:
  - SavedModel: `har/004/export/acc_v1_keras/saved_model`
  - TFLite int8: `har/004/export/acc_v1_keras/phase0-1-acc.v1.int8.tflite` (sha256=`e1c3ff0042badac5dd9bb478a17fac79991736c813143b45e5cb981d9db68610`)
  - manifest: `har/004/export/acc_v1_keras/manifest.json`（config/ckpt/sha256/rep_data/PTQ条件/比較結果を記載）

## PyTorch vs TFLite 比較 (再現性チェック)
- スクリプト: `har/004/tools/compare_pytorch_tflite.py`
- 入力: `har/001/data_processed/subject01.npz` から 200窓
- 結果: argmax一致率=0.9800, max_prob MAE=0.0277（目標≦0.03をクリア）
- 判定: TinyMLアーティファクト v1 として採用可能

## ログ/メタの追記
- decision_log: `har/004/docs/decision_log_2025-11-26.md` に TinyML v1 の tflite パス・sha256・PTQ条件・比較結果を追記。
- manifest: `har/004/export/acc_v1_keras/manifest.json` を作成し、tflite/pthのsha256、rep_samples、比較結果を明文化。

## 残タスク / 次ステップ
- 可能なら TFLite出力ベースで θ_low/θ_high を再キャリブして記録。
- ESP32/TFLM統合へ進む: `har_model_infer` ラッパ（int8量子化/復元）、HarOut/Policy skeleton (C)、t_inf/Arena計測ベンチの実装。
