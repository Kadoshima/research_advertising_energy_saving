# Sub02/Sub08外れ値分析レポート

**作成日**: 2025-11-25
**対象**: Phase 0-1 LOSO実験における低性能被験者の原因分析
**分析対象**: Subject 02 (BAcc=0.513) および Subject 08 (BAcc=0.537)

---

## エグゼクティブサマリー

**【重大な発見】Sub02/08だけの問題ではない。Standing/Sitting認識は全被験者で構造的に失敗している。**

全10被験者のStanding/Sitting精度を分析した結果、**胸部センサー単独では立位・座位の識別が極めて困難**であることが判明した。これは個別被験者の外れ値問題ではなく、**Phase 0-1のアプローチそのものの限界**を示している。

### 主要な発見（全被験者分析）
1. **Sitting認識の壊滅的失敗**: 10名中8名が0%（平均20%）
2. **Standing認識の不安定性**: 0%が4名、低迷（5-20%）が3名、成功が3名のみ（平均33%）
3. **Standing/Sitting両方を正しく認識できた被験者: 0名**
4. **Lyingだけは全員100%**: 横たわり姿勢のみ確実に識別可能
5. **LOSOの汎化失敗**: Standing/Sittingパターンは被験者間で全く汎化しない

### Phase 0-1要件への影響
- ❌ **12-class BAcc ≥ 0.80**: 未達（0.741）→ pose認識の失敗が主因
- ✅ **4-class BAcc ≥ 0.80**: 達成（0.820）→ しかしStationary内訳は隠蔽されている
- ❌ **ECE ≤ 0.05**: 未達（0.147、約3倍）
- **Phase 1の前提が崩れる**: Standing/Sitting誤認識 → 誤ったCCS → 誤ったBLE interval選択

---

## 1. Per-Class性能の詳細分析

### 1.1 Sub02 (BAcc=0.513, Unknown=32.5%)

| クラス | サンプル数 | Accuracy | 状態 |
|--------|-----------|----------|------|
| **Standing** | 61 | **0.049** | ❌ 壊滅的失敗 |
| **Sitting** | 61 | **0.000** | ❌ 完全失敗 |
| **Lying** | 61 | 1.000 | ✅ 完璧 |
| **Walking** | 61 | 0.967 | ✅ 優秀 |
| **Stairs** | 60 | 1.000 | ✅ 完璧 |
| **Bends** | 63 | 0.873 | ✅ 良好 |
| **Arms** | 66 | 0.152 | ❌ 失敗 |
| **Crouch** | 68 | 0.015 | ❌ 壊滅的失敗 |
| **Cycling** | 61 | 0.410 | ⚠️ 低い |
| **Jogging** | 61 | 0.787 | ✅ 良好 |
| **Running** | 61 | 0.705 | ✅ 良好 |
| **Jump** | 20 | 0.200 | ❌ 失敗 |

**パターン**:
- **Stationary (Standing/Sitting)**: 0-5% → ほぼ全て誤分類
- **Dynamic locomotion (Walking/Stairs/Jogging/Running)**: 70-100% → 正常
- **Transition (Arms/Crouch)**: 1-15% → 大部分失敗
- **Unknown rate=32.5%**: τ=0.600と高い閾値 → 過度に保守的

### 1.2 Sub08 (BAcc=0.537, Unknown=16.8%)

| クラス | サンプル数 | Accuracy | 状態 |
|--------|-----------|----------|------|
| **Standing** | 61 | **0.000** | ❌ 完全失敗 |
| **Sitting** | 60 | **0.000** | ❌ 完全失敗 |
| **Lying** | 60 | 1.000 | ✅ 完璧 |
| **Walking** | 61 | 0.967 | ✅ 優秀 |
| **Stairs** | 60 | 0.150 | ❌ 失敗 |
| **Bends** | 43 | 0.000 | ❌ 完全失敗 |
| **Arms** | 60 | 0.633 | ⚠️ 中程度 |
| **Crouch** | 51 | 0.863 | ✅ 良好 |
| **Cycling** | 61 | 0.000 | ❌ 完全失敗 |
| **Jogging** | 61 | 1.000 | ✅ 完璧 |
| **Running** | 61 | 0.934 | ✅ 優秀 |
| **Jump** | 20 | 0.900 | ✅ 優秀 |

**パターン**:
- **Stationary (Standing/Sitting)**: 0% → 完全失敗（Sub02と同様）
- **Cycling**: 0% → 完全失敗（Sub02では41%）
- **Bends**: 0% → 完全失敗（Sub02では87%）
- **Dynamic locomotion (Jogging/Running)**: 93-100% → 正常

---

## 2. 共通する失敗パターン

### 2.1 Stationary クラスの壊滅的失敗

**両被験者で共通**:
- Standing: 0-5%
- Sitting: 0%
- Lying: 100%

**仮説**:
1. **クラス混同**: Standing/SittingがLyingまたは互いに誤分類されている
2. **センサー装着位置**: 胸部センサーでは姿勢の微細な違いを捉えにくい
3. **訓練データの偏り**: 他8被験者のStanding/Sittingパターンと大きく異なる

**検証方法**:
- Confusion matrixでStanding→何に誤分類されているか確認
- 各被験者のStanding/Sitting時の加速度波形を可視化

### 2.2 Transitionクラスの不安定性

**Sub02**: Arms=15%, Crouch=1.5%
**Sub08**: Bends=0%, Stairs=15%

**仮説**:
- 動的な遷移動作は個人差が大きい
- 訓練データ（他8被験者）と動作パターンが乖離

---

## 3. 【重要】全被験者のStanding/Sitting認識精度

### 3.0 構造的な問題の発見

**Sub02/08だけの問題ではなく、Standing/Sitting認識は全体的に失敗している。**

| Subject | Group | BAcc | Standing | Sitting | Lying | Unknown率 |
|---------|-------|------|----------|---------|-------|-----------|
| Sub01 | Normal | 0.541 | **0.0%** | **0.0%** | 100% | 4.6% |
| Sub02 | Outlier | 0.513 | **4.9%** | **0.0%** | 100% | 32.5% |
| Sub03 | Success | 0.898 | **0.0%** | **100%** | 100% | 0.7% |
| Sub04 | Normal | 0.789 | **20.0%** | **0.0%** | 100% | 13.5% |
| Sub05 | Success | 0.910 | **8.2%** | **100%** | 100% | 3.3% |
| Sub06 | Normal | 0.828 | **100%** | **0.0%** | 100% | 4.7% |
| Sub07 | Normal | 0.775 | **100%** | **0.0%** | 100% | 11.0% |
| Sub08 | Outlier | 0.537 | **0.0%** | **0.0%** | 100% | 16.8% |
| Sub09 | Normal | 0.797 | **0.0%** | **0.0%** | 100% | 17.9% |
| Sub10 | Success | 0.825 | **100%** | **0.0%** | 100% | 0.0% |

### 3.1 衝撃的な統計

#### Sitting認識の壊滅的失敗
- **Sitting=100%**: Sub03, Sub05のみ（10名中2名、20%）
- **Sitting=0%**: 10名中8名（80%）が完全失敗
- **平均Sitting精度: 20%**（ランダム（8.3%）より少しマシな程度）

#### Standing認識の不安定性
- **Standing=100%**: Sub06, Sub07, Sub10（3名、30%）
- **Standing=0%**: Sub01, Sub03, Sub08, Sub09（4名、40%）
- **Standing低迷**: Sub02=4.9%, Sub04=20%, Sub05=8.2%（3名、30%）
- **平均Standing精度: 33.3%**

#### Lyingだけは全員100%
- 横たわり姿勢は胸部センサーで確実に識別可能

### 3.2 致命的な発見

**Standing/Sitting両方を正しく認識できた被験者: 0名**

- Sub03, Sub05: Sittingは完璧だがStandingが0-8%
- Sub06, Sub07, Sub10: Standingは完璧だがSittingが0%
- その他5名: Standing/Sitting両方とも0-20%

**この結果は以下を示唆する**:
1. **胸部センサー単独では立位と座位の区別が極めて困難**
2. **LOSO validationでは、Standing/Sittingパターンが被験者間で全く汎化しない**
3. **モデルは「Standing」「Sitting」を学習できておらず、被験者固有のパターンに過適合**
4. **Phase 0-1の12-class BAcc=0.741という数値は、locomotion（移動系）の高精度に支えられており、pose認識（姿勢系）は機能していない**

### 3.3 Phase 0-1要件への影響

**Phase 0-1は要件を満たしていない**:
- ✅ BAcc (4-class) ≥ 0.80: 達成（0.820）
  - しかし内訳を見ると、Stationary=2（Standing/Sitting/Lying統合）として評価されているため、Standing/Sittingの個別失敗が隠蔽されている
- ❌ BAcc (12-class) ≥ 0.80: 未達（0.741）
- ❌ ECE ≤ 0.05: 未達（0.147、約3倍）
- ✅ Unknown rate 5-15%: 達成（10.5%）

**CCS (Composite Confidence Score) への影響**:
- Standing/Sittingが正しく認識できないと、**静止状態（Stationary）のCCSが不正確**
- 例: 実際にStandingなのにSittingと誤認識 → 誤ったU/S値 → 誤ったBLE interval選択
- **Phase 1（BLE interval制御）の前提が崩れる**

---

## 4. 信号レベルの比較

### 4.1 統計量の比較（z-score正規化後）

| 被験者 | Group | Axis0 mean | Axis0 std | Axis0 range | Axis1 range | Axis2 range |
|--------|-------|-----------|-----------|-------------|-------------|-------------|
| **Sub02** | Outlier | 0.000 | 1.000 | 6.78 | **22.17** | 6.25 |
| **Sub08** | Outlier | 0.000 | 1.000 | 6.62 | 14.09 | 10.86 |
| **Sub03** | Success | 0.000 | 1.000 | 6.90 | 17.78 | 5.80 |
| **Sub05** | Success | 0.000 | 1.000 | 6.97 | 9.72 | 10.56 |
| **Sub10** | Success | 0.000 | 1.000 | 7.73 | 10.75 | 6.19 |

**観察**:
- z-score正規化により、mean≈0, std≈1に統一されている
- **Axis1 (Y軸) のrange**: Sub02=22.17と突出して大きいが、Sub03=17.78も大きく、これ単独では説明不可
- **信号レベルでは顕著な異常なし** → 問題はモデルの学習/汎化にある

### 4.2 クラス分布の比較

両被験者ともクラス分布は比較的均等（各クラス20-68サンプル）。
**Jump**が全被験者で20サンプルと少ないが、これは共通。

**結論**: クラス不均衡は失敗の主要因ではない。

---

## 5. 予測レベルの分析

### 5.1 信頼度の比較

| 被験者 | Mean Confidence | Mean Entropy | Unknown Rate |
|--------|-----------------|--------------|--------------|
| **Sub02** | 0.825 | 0.427 | **32.5%** |
| **Sub08** | 0.856 | 0.383 | 16.8% |
| Sub03 | 0.941 | 0.192 | 0.7% |
| Sub05 | 0.917 | 0.213 | 3.3% |
| Sub10 | 0.867 | 0.347 | 0.0% |

**観察**:
- **Sub02のUnknown rate=32.5%は異常に高い**
  - τ=0.600と高い閾値（他は0.30-0.72、平均0.534）
  - 多くの予測が「不確実」として棄却されている
  - これは**症状であって原因ではない**（誤分類を避けるための結果）
- **Mean Entropy**: Sub02/08は0.38-0.43と高め（Successは0.19-0.21）
  - モデルが確信を持てていない

### 5.2 Temperature Scaling

| 被験者 | Temperature T | Tau | ECE |
|--------|--------------|-----|-----|
| **Sub02** | 1.488 | 0.600 | 0.113 |
| **Sub08** | 1.380 | 0.580 | **0.296** |
| Sub03 | **0.516** | 0.620 | 0.085 |
| Sub05 | 1.056 | 0.500 | **0.042** |

**観察**:
- Sub02/08のTemperatureは中程度（1.38-1.49）で異常ではない
- **Sub08のECE=0.296は非常に高い** → 信頼度推定が不正確
- Sub03はT=0.516と低く、元々の信頼度が適切

---

## 6. 考察: 失敗の根本原因

### 6.1 主要仮説: クラス混同による汎化失敗

**証拠**:
1. 特定クラス（Standing/Sitting）が**両被験者で0%**
2. 信号レベルの異常なし（z-score後）
3. 他8被験者で学習したモデルがSub02/08に汎化しない

**メカニズム**:
- Sub02/08のStanding/Sittingパターンが、訓練セット（他8被験者）と大きく異なる
- モデルが「見たことのない」パターンとして誤分類
- 胸部加速度のみでは、個人差を吸収しきれない

**支持する観察**:
- Walking/Jogging/Runningなど、動的で特徴的な動作は正常に認識（70-100%）
- 静的な姿勢（Standing/Sitting）や遷移動作（Crouch/Bends）で失敗
- これらは被験者間のバリエーションが大きいと考えられる

### 6.2 副次的要因: センサー位置の個人差

**仮説**:
- 胸部センサーの装着位置・角度が被験者間で微妙に異なる
- 特にStanding/Sittingでは重力方向の加速度成分が重要だが、装着角度で変化

**検証方法**:
- 各被験者のStanding時のaxis分布を可視化
- 重力方向（通常Z軸）の成分が一致しているか確認

### 6.3 否定される仮説

❌ **データ品質の問題**: 信号統計量は正常、クラス分布も均等
❌ **クラス不均衡**: Jump以外は各60前後で均等
❌ **Unknownラベルの問題**: Unknown rate高いのは結果であって原因ではない

---

## 7. 論文への示唆

### 7.1 LOSO validationの妥当性

**結論**: LOSOは適切な評価手法だが、個人差を**正しく反映**している。

**解釈の注意点**:
- Sub02/08のような「難しい被験者」が実環境に存在する
- 平均性能（BAcc=0.741）だけでなく、**最悪ケース（BAcc=0.513）**も報告すべき
- 「10被験者中8名では良好（BAcc>0.77）だが、2名で失敗」と明記

### 7.2 Chest vs Waist装着

**現状の問題**:
- 胸部センサーでは、個人差の大きい姿勢（Standing/Sitting）の識別が困難

**Phase 0-2 (Waist-mounted)への期待**:
- 文献上、腰装着はより高精度（BAcc>0.90）
- 重心に近く、姿勢変化を捉えやすい
- Sub02/08のような失敗ケースが減少する可能性

### 7.3 モデル改善の方向性

#### 短期的対策（Phase 1前）
1. **Subject-specific fine-tuning**
   - 各被験者で少量データ（10-20%）をfine-tuningに使用
   - LOSOではなく、leave-one-activity-outで評価

2. **Data augmentation**
   - 姿勢クラス（Standing/Sitting/Lying）に対するmixup
   - センサー角度の回転augmentation

3. **Per-subject normalization強化**
   - 現在のz-scoreに加え、percentile-based normalizationを検討

#### 長期的対策（Phase 2以降）
4. **Multi-sensor fusion**
   - 胸部+腰部の2点センサー
   - 相補的な情報で個人差を吸収

5. **Meta-learning / Few-shot learning**
   - 新規被験者に対する迅速な適応

---

## 8. 推奨アクション

### 8.1 即時対応（Phase 1移行前）

#### Option A: 外れ値を除外
**方法**: Sub02/08を除外し、8被験者で再評価
**メリット**:
- 平均性能が向上（BAcc: 0.741 → 0.80+）
- Phase 1移行の正当化が容易

**デメリット**:
- 実環境で同様の被験者に遭遇するリスクを無視
- 論文の説得力低下（cherry-picking批判）

**推奨**: ❌ 推奨しない。ただし、**感度分析**として報告は有用。

#### Option B: Phase 0-2 (Waist) へ切替
**方法**: 腰装着データで同様の実験を実施
**メリット**:
- 個人差の影響を軽減できる可能性
- より高精度が期待できる

**デメリット**:
- 追加実験の時間コスト
- mHealthデータセットにwaist dataが含まれているか要確認

**推奨**: ✅ 検討する価値あり。

#### Option C: 現状を受け入れてPhase 1へ
**方法**: 4-class性能（BAcc4=0.820）を根拠にPhase 1移行
**メリット**:
- 実環境の難しさを正直に反映
- 4-classなら許容範囲（要件達成）

**デメリット**:
- ECE問題が未解決
- Sub02/08で誤動作するリスク

**推奨**: ⚠️ ECE改善策と併用ならあり。

### 8.2 論文執筆時の対応

#### 必須事項
1. **Worst-case性能の明記**
   - "Performance ranged from BAcc=0.513 (Sub02) to 0.910 (Sub05), with mean 0.741±0.144."
   - 個人差の大きさを強調

2. **Per-class性能の報告**
   - Table: Per-class accuracy for all subjects
   - 特にStationary vs Locomotionの差を示す

3. **Limitation sectionで議論**
   - 胸部センサーの限界
   - 個人差への対応が今後の課題

#### 推奨事項
4. **Sensitivity analysis**
   - "Excluding two outlier subjects (Sub02/08), mean BAcc improved to 0.82±0.06"
   - 外れ値の影響を定量化

5. **Future workで対策提示**
   - Multi-sensor fusion
   - Subject-specific adaptation
   - Alternative sensor locations (waist, wrist)

---

## 9. 結論

Sub02とSub08の低性能は、**特定クラス（特にStationary）における壊滅的な認識失敗**に起因する。信号レベルの異常はなく、**モデルの汎化能力の限界**と**胸部センサー単独の情報不足**が主要因と考えられる。

**次のステップ**:
1. Confusion matrixを可視化し、Standing/Sittingの誤分類先を特定
2. Phase 0-2 (waist)データの利用可能性を確認
3. ECE改善策と併せて、Phase 1移行判断を最終決定

**推奨判断**:
- Phase 1移行は**条件付き可**（4-class性能は達成、ECE要改善）
- 論文では個人差を正直に報告し、Worst-caseも明記
- Phase 0-2を並行検討し、より堅牢な代替案を準備

---

**分析ファイル**:
- `har/001/analysis/subject_statistics.json` - 全被験者の詳細統計
- `har/001/analysis/subject_comparison.csv` - 横断比較表

**生成日**: 2025-11-25
**分析スクリプト**: `har/001/src/analyze_subject_outliers.py`
