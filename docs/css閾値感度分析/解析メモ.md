# CCSしきい値感度分析 解析メモ（論文用の書きどころ）

## 1. データと前提
- 入力: `data/ccs_sequences/subject*.csv`（CCS = 0.6U + 0.4(1−S) を再計算して使用）
- スイープ結果: `data/ccs_sweep/threshold_sweep_summary.csv`（旧高域グリッド）、`data/ccs_sweep/threshold_sweep_summary_quantile.csv`（分布準拠グリッド）、各Pareto抜粋は同ディレクトリの `*_pareto*.txt`
- モデル: ヒステリシス無しの純粋写像（CCS≥θ_high→100ms, θ_low≤CCS<θ_high→500ms, CCS<θ_low→2000ms）
- パラメタ: p_d=0.85、ΔE/adv={100:2256.82, 500:9760.08, 2000:39481.76} µJ/adv、τ=1/2/3s

## 2. CCS分布としきい値設計の教訓
- CCS分布（全被験者合算）：median≈0.016, q75≈0.206, q95≈0.397（max≈0.796）。低域に極端に偏在。
- 旧高域グリッド（θ_low≥0.70, θ_high≥0.82）は分布とミスマッチ → w_2000≈99.9%, Pout(2s)≈15%, 省エネ≈12.5%（100ms比）。**ほぼ固定2000msになる失敗例**として明示する。
- 分布準拠グリッド（θ_low∈{0.001,0.004,0.010,0.05,0.10}, θ_high∈{0.16,0.28,0.40}, gap≥0.05）で再スイープすると、w_2000≈8.7% で張り付き、Pout(2s)≈1.33–1.35%、省エネ≈9–13% で頭打ち。

## 3. 代表ポリシー候補（分布準拠グリッドのParetoから）
- P1: θ_low=0.001, θ_high=0.400 → w100=4.86%, w500=86.45%, w2000=8.69%, Pout(2s)=1.35%, 省エネ=12.8%
- P2: θ_low=0.001, θ_high=0.280 → w100=14.26%, w500=77.05%, w2000=8.69%, Pout(2s)=1.34%, 省エネ=11.5%
- P3: θ_low=0.001, θ_high=0.160 → w100=29.62%, w500=61.69%, w2000=8.69%, Pout(2s)=1.33%, 省エネ=9.4%
（→ Poutはほぼ w_2000×15% で決まり、w_2000がほぼ定数なので Poutは1.3%帯で張り付く。差は省エネのみ。）

## 4. 理論上限の示唆（論文で一言添える）
- ΔE/adv と interval から算出すると、広告レイヤの平均電力は 100ms:22.6 mW, 500ms:19.5 mW, 2000ms:19.7 mW と「ほぼ一定」。
- よって interval 最適化で得られる省エネの上限は広告レイヤで ≈12–13% 程度。ベースライン P_off≈22 mW を含むシステム全体ではさらに小さくなる。
- 現在の結果（省エネ9–13%）はこの上限の 70–100% に相当し、**しきい値調整だけでこれ以上の大幅改善は物理的に期待しにくい**ことを明記する。

## 5. 論文で書くべきポイント
1) ネガティブ例として旧グリッドを紹介：分布に合わないと実質2000ms固定になり Poutが15%まで悪化。  
2) 分布準拠グリッド＋代表3点を提示：Pout≦2%台・省エネ9–13%の範囲を「現実的スイートスポット」として表1/図で示す。  
3) 図: Pout(2s)–μC散布（固定100/2000もプロット）。旧グリッドは右上に固まる、新グリッドは左下寄りになることを一目で見せる。  
4) 設計指針: CCSしきい値は「分布を見て決める」のが必須。高域に置くと w_2000 が暴走する。  
5) Safe-Banditへの接続: しきい値スイープで得た Pareto 点を「安全側アーム集合」とし、学習は w_2000 をどこまで許容するか＋ w100 vs w500 配分を微調整する問題として位置付ける。  

## 6. ToDo（軽めの追加で質が上がるもの）
- CCS分布のヒストグラム/CDF を1枚追加（図や補足資料）。q10〜q95を明示。
- 表1を代表3点（P1–P3）＋固定100/2000で組む。w_100/500/2000, Pout(1/2/3s), 省エネを掲載。
- 図1: Pout(2s)–μC 散布図（旧グリッド vs 分布準拠グリッド vs 固定100/2000）。  
- 実装節との接続: 解析はヒステリシス無し、実装はヒステリシスあり・最小滞在2sと明記。
