以下は、**フェーズ0-0（先行デモ）要件定義書**です。フェーズ1で定義されたログ構造とKPIを維持しつつ、HARの完成を待たずにBLE安全バンディット系の評価を開始するための準備段階を示します。

# フェーズ0-0 要件定義書（先行デモ）

**文書ID**: ReFormHAR‑Tiny/REQ‑PH0‑0‑v1.0  
**対象**: 擬似U/S信号によるCCS→広告間隔制御の検証  
**成功見込み**: 95%

## 1. 目的
- HAR（人的活動認識, Human Activity Recognition）非依存の擬似U（不確実度, Uncertainty）・S（安定度, Stability）を生成し、CCS（複合スコア, Composite score）→アドバタイズ間隔の全系を“動かす”。
- BLE安全バンディットに必要な期限超過率（Pout, τ）、初回到達遅延（Time-to-first-Receive, TL）、電力メトリクスの評価線をフェーズ1と同一スキーマで作成する。
- 後続フェーズに向けてログ、閾値、ヒステリシスの実装差分を最小化し、方策差し替えの準備を整える。

## 2. スコープと境界
- **対象機能**: BLEレガシー・アドバタイジング（BLE Legacy Advertising, 3チャネル固定）、アドバタイズ間隔（adv_interval）∈ {100, 500, 1000, 2000} ms、擬似U/Sに基づくCCS写像。
- **擬似信号仕様**:
  - `U_dummy = normalize(|acc|の窓内分散)`（高振幅=高不確実度）
  - `S_dummy = clamp(1 − ΔE_norm, 0, 1)`（エネルギー変化率が低いほど安定）
  - `CCS = 0.6×U_dummy + 0.4×(1 − S_dummy)` をヒステリシス±0.05で段階写像。
- **除外**: HARモデル実装、MAB/Safe‑MAB学習、チャネル可変、Tx電力最適化。

## 3. 成功指標と受入基準
- **期限超過率（Pout, τ=1 s）**: 固定100 ms条件と比較して違反率の増加が±0.5 pt以内。
- **平均電流**: 固定100 ms条件比で**≥5–10%削減**の傾向を確認。
- **イベント電荷**: フェーズ1の測定手順に従い±5%以内で再現。
- **ログ完全性**: 欠損率<1%、U/S/CCS∈[0,1]、閾値・ヒステリシスの記録あり。

## 4. 主な作業レーン
1. 擬似U/S算出モジュールのパラメタ確定（窓長1.0 s、50%重畳、重力除去OFF）。
2. フォールバック（1000 ms）・ヒステリシス・最小滞在時間（≥2 s）の実装確認。
3. Runbook（`docs/フェーズ1/Runbook.md`）準拠の実験：環境E1/E2 × 条件5 × 各≥2反復。
4. KPI集計（期限超過率, Pout／初回到達遅延, TL p50/p95／平均電流／イベント電荷）と比較プロット。

## 5. 成果物
- 擬似U/S仕様書（式、パラメタ、正規化係数）。
- 実装時の設定ファイル（CCS閾値、ヒステリシス、最小滞在時間、フォールバック区分）。
- KPIレポート（固定基準との比較、95% CI付き）。
- ログ一式（送信・受信・電力・導出KPI）およびDecisionMeta。

## 6. リスクと緩和
- **擬似指標の過度な振動** → 移動平均（3窓）とヒステリシス強化で抑制。
- **振幅変動が環境依存** → 窓内標準化と環境別スケーリング係数をRunbookに記録。
- **評価遅延の偏り** → TLのCDFと期限超過率（Pout, τ=1/2/3 s）を必ず比較し、逸脱時はパラメタ調整。

## 7. フェーズ1との接続
- ログスキーマ、写像表、閾値定義はフェーズ1（弱い構成）と完全互換。
- 評価レポートはフェーズ1の要件定義に記載されたKPI差分表フォーマットを流用。
- 成果物はフェーズ1のPolicy Engineにそのまま供給でき、後続のHAR更新時は擬似U/Sを実U/Sに差し替えるだけで連続運用可能。
