# フェーズ0-0 サマリ（計測系ベースライン確定）

## 実験セット概要
- 条件: E2, 距離1 m, adv_interval={100,500,1000,2000} ms, TxPower=0 dBm
- ONデータ: `data/実験データ/研究室/row_1120/TX`（TXSD）, `.../row_1120/RX`
- OFFデータ: `data/実験データ/研究室/row_1123_off/TX`
- manifest: `experiments_manifest.yaml`（include=false を解析で自動スキップ）

## KPI定義（v1）
- ΔE/adv = (E_on − P_off × T_on) / N_adv [mJ/adv]
  - E_on, T_on, N_adv: ON trial の TXSD #summary (`E_total_mJ`, `ms_total`, `adv_count`)
  - P_off: OFF trial の P_off_trial=E_off/(ms_off/1000) を median±3MAD で外れ除外後の平均
- PDR（正式）: PDR_ms = rx_unique / (ms_rx / interval_ms) （RX mfd seq 去重, max=1.0 で clip）
  - 参考: PDR_raw = rx_count_raw / adv_count, PDR_unique = rx_count_unique / adv_count（どちらも clip可）
- 外れ値ルール
  - ON: E_total_mJ > median+3MAD → include=false, cluster_id="<interval>ms_high_current"
  - OFF: P_off_trial > median+3MAD → include=false, cluster_id="off_high_baseline"

## 使用スクリプト
- 単位/健全性: `scripts/check_units.py`, `scripts/check_units_off.py`
- ΔE/adv計算: `scripts/compute_delta_energy_off.py`（manifest遵守、OFFはMADフィルタでP_off_mean算出）
- PDR計算: `scripts/compute_pdr_join.py`（`--dedup-seq` で seq去重, `--clip-pdr` で max=1.0）

## 集計結果（row_1120 ON × row_1123_off OFF, manifest+MAD3）
- P_off_mean: 22.106 mW（OFF 7/7 keep）
- ΔE/adv [mJ/adv, mean±std]:
  - 100ms: 2.2568 ± 0.1622
  - 500ms: 9.7601 ± 0.3392
  - 1000ms: 19.6611 ± 0.1335（1m_on_1000_005.csv を high_current_outlier で除外済み）
  - 2000ms: 39.4818 ± 0.0631
- PDR_ms_mean（clip済）:
  - 100=0.814, 500=0.845, 1000=0.872, 2000=0.876
- 参考 PDR（clip前の平均）:
  - PDR_raw_mean: 100=1.149, 500=0.921, 1000=0.921, 2000=0.915
  - PDR_unique_mean: 100=1.120, 500=0.897, 1000=0.898, 2000=0.888

## 主な出力ファイル
- ΔE/adv集計: `docs/フェーズ1/results/delta_energy_row1120_row1123_off.md`
- PDR集計: `docs/フェーズ1/results/pdr_row1120_txsd_rx.md`
- フェーズ1まとめ: `docs/フェーズ1/results/phase1_summary.md`

## ルールメモ（再掲）
- ON外れ値: median±3MAD（E_total_mJ）で high_current_outlier。1000ms の 1 本のみ除外、他 interval は現状全採用。
- OFF外れ値: median±3MAD（P_off_trial）で high_baseline_outlier。row_1123_off は 7/7 keep（外れなし）。
- PDR運用:
  - 正式値は PDR_ms（clip済）。PDR_ms>1.1 や <0 の trial は `pdr_inconsistent` として除外候補。
  - PDR_raw/unique は TXSD整合チェック用の参考値。
