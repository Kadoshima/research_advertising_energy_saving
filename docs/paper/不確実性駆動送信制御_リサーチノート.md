以下は、**エッジデバイスにおける不確実性認識型・信頼度駆動型データ送信制御**に関する2021–2025年の主要研究を、**具体的なメカニズム・メトリクス・プロトコル実装・実験結果**に絞って整理したリサーチノートです。  
一般的なサマリーやパラダイム転換の議論は省き、実装上有用な「深い部分」のみを記録します。

---

# 1. 不確実性指標とオンデバイス実装

## 1.1 信頼度スコア（Softmax最大値）とキャリブレーション

- **定義**
  - `S_conf = max(softmax(z))`（z はロジットベクトル）。
  - エッジでは追加計算コストがゼロに近く、**最安の不確実性代理指標**として広く利用。

- **エッジでの具体的利用パターン**
  - **適応的認識 / サンプリング制御**
    - ウェアラブルの行動認識や端末内HARで、連続フレームの `S_conf` を監視。
    - 例: `S_conf > 0.85` が一定時間続く場合 → 推論が安定したとみなし、
      - センササンプリングレート↓（例: 50 Hz → 10–20 Hz）
      - 通信周期↑（例: 100 ms → 500–2000 ms）
    - `S_conf` が揺らぐ区間（過渡期）は、逆にサンプリング・通信頻度を一時的に増やす。
  - **早期終了（Early Exit）**
    - BranchyNet系の多出口CNNや Cloud-Edge協調LLMでは、中間層ごとの `S_conf` を監視。
    - `S_conf ≥ τ_exit`（例: 0.9）なら中間出口で推論を打ち切って結果を採用。
    - `S_conf < τ_exit` の場合のみ、より深い層 or クラウドにフォワード。
    - これにより、**平均演算量と送信頻度を同時に削減**。

- **問題点と対策**
  - Softmax は**過信（overconfidence）しやすい**ため、そのまま通信制御の閾値に使うと危険。
  - エッジ向け研究では、以下のような軽量キャリブレーションが実装されている。
    - **温度スケーリング（Temperature Scaling）**
      - 追加パラメータ T（スカラー）を導入し、`softmax(z/T)` で後処理。
      - バリデーション上の NLL/ECE を最小にする T を1次元探索で決定。
    - **Platt Scaling / 平滑化**
      - 出力の上側（0.5–1.0）に集中する確率を圧縮し、実際の正解率との整合を向上。
  - これらの処理により、**「S_conf > 0.9」なら実際の精度も ≈90%** 程度になるよう整えてから、送信制御に用いる。

---

## 1.2 情報エントロピーと優先度スケジューリング

- **定義**
  - `H = - Σ p_i log p_i`（p_i はクラス確率）。
  - 分布が平坦（迷っている）ほど H が高く、**モデルの迷いを直接表現**。

- **通信制御への具体的利用**
  - **トラフィック異常検知系**
    - IoTゲートウェイが、センサの通信パターン（ポート/パケットサイズ/周期）の分布から H を算出。
    - 通常時: H が低く安定 → ログ送信を抑制（定期サマリのみ）。
    - 異常時: H が急上昇（予測不能な通信パターン） → 詳細ログやパケットダンプを集中送信。
  - **UAV支援データ収集**
    - 多数の地上センサに対し、「AoI（Age of Information）」と「エントロピー」を組み合わせて優先度を算出。
    - `priority ∝ H × f(AoI)` とし、
      - H が低く変化の少ないノードは巡回頻度↓、
      - H が高く、かつ AoI が大きいノードを優先的に訪問・データ回収。
    - 結果として、限られた飛行時間の中で **「情報価値の高いノード」からの取得率を最大化**。

- **特徴**
  - Softmax最大値と異なり、**「どの程度迷っているか」** を多クラスで扱えるため、
    - 未知クラス検知、緩やかな変化検知、優先度制御に向いている。

---

## 1.3 ワンパス不確実性推定（Single-Pass Uncertainty）

- **従来手法の問題**
  - MC-Dropout やベイジアンNNによる不確実性推定は、
    - 同じ入力に対して **数十回の推論** を実行して分散を推定。
    - レイテンシ・消費電力ともに **O(N_samples)** で増大 → バッテリ駆動エッジには不適。

- **ワンパス系の解法（代表例）**
  - モデル側の正則化・構造変更により、
    - **1回のフォワードパスだけで「予測値＋不確実性」の両方を出力**する。
  - 典型的な構成要素:
    - **スペクトル正規化（Spectral Normalization）** による重みの制御。
    - **層ごとの分布近似**（例えば、最終層でガウス分布の平均・分散を直接出力）。
    - 損失関数に、**不確実性に基づくペナルティ項**を組み込む。

- **実験結果（Jetson Nano / TX2 等）**
  - 推論ごとに「予測＋分散」を得て、その分散を基準に
    - 送信/破棄/クラウドオフロードを判定。
  - ベースライン（MC-Dropout等）と比較して:
    - **エネルギー消費が最大 ≈28倍削減**。
    - レイテンシは、通常の推論＋行列演算数回増の範囲に収まる（実時間制御可能）。

---

## 1.4 偶然的不確実性（Aleatoric）と認識的不確実性（Epistemic）の分離

- **目的**
  - 「不確実だから送信する」のではなく、
    - **ノイズ起因の不確実性（Aleatoric）**：再サンプリングやローカル処理で対処すべき。
    - **知識不足起因の不確実性（Epistemic）**：クラウドや人間による再評価が必要。
  - この区別により、**不要なクラウド送信を抑えつつ、本当に重要なケースだけオフロード**できる。

- **オンデバイスでの扱い**
  - モデル側で「予測の分散」を
    - 観測ノイズに対応する成分（出力ヘッド側の分散）、
    - モデル不確実性に対応する成分（パラメタ分布由来）、
    に分解する設計が提案されている。
  - 制御ロジック例:
    - Aleatoric が支配的 → **同じセンサからの追加サンプル収集**を優先（送信は控える）。
    - Epistemic が支配的 → **生データ送信 or 高精度モデルへのオフロード**を優先。

---

# 2. 動的送信制御メカニズム

## 2.1 ファジィ論理制御（Fuzzy Logic Controller, FLC）によるBLEパラメータ制御

- **入力・出力変数**
  - 入力（例）:
    - 不確実性: {Low, Medium, High}（Softmax/Entropy由来）。
    - バッテリ残量: {Critical, Normal, Full}。
    - RSSI（リンク品質）: {Weak, Strong}。
  - 出力:
    - BLE接続間隔: {Short (≈7.5 ms), Medium, Long (≈4 s)}。
    - 送信電力: {Min（-20 dBm）, …, Max（+20 dBm）}。

- **ルール例**
  - `IF Uncertainty is High AND Battery is Normal THEN Interval is Short AND TxPower is Max`
    - 高不確実＋バッテリ余裕 → 確度を優先して高頻度・高出力で送信。
  - `IF Uncertainty is Low AND Battery is Low THEN Interval is Long AND TxPower is Min`
    - 推論は安定＋バッテリ低 → ハートビートのみ、電力極小で維持。

- **パラメタ最適化（PSO利用）**
  - メンバーシップ関数の形状（どこから High とみなすか等）を
    - 粒子群最適化（PSO）で自動調整。
  - 目的関数例:
    - **バッテリ寿命最大化**（平均電流 or mWh/日）。
    - かつ **QoS指標（到達率/正解率）≥95%** を制約として課す。

- **報告されている効果（ウェアラブルBLEデバイスなど）**
  - 静的設定と比較して、
    - 消費電力 **25–45%削減**。
    - 到達率（QoS）は **95%以上** を維持。
    - 「正常・高信頼」期間は実質的な Radio-on duty を **1%未満** に抑制。

---

## 2.2 Restless Multi-Armed Bandit（RMAB）とゲイン・インデックス

- **問題設定**
  - 多数のセンサノードが 1 つのゲートウェイ/UAV を共有する状況。
  - 各ノードは時間とともに
    - **情報の古さ（AoI）**、
    - **不確実性（Entropy など）**
    が変化し続ける。
  - 同時に通信できるノード数には上限がある（帯域制約）。

- **RMAB定式化とポリシー**
  - 各ノード n に対し、状態 s_n（AoI, 不確実性など）から「ゲイン・インデックス g_n」を計算。
  - スケジューラは、各ラウンドで **g_n が大きい順に上位 M ノードを選択**して送信権を与える。
  - g_n は「そのノードからデータを受け取ることで削減できるシステム損失（不確実性＋情報陳腐化）」を表す。

- **特徴と結果**
  - 単純な AoI ベース（古いデータ優先）に比べて、
    - **変化が激しく（高エントロピー）かつ情報が古いノード**を優先するため、
    - 閾値ベースでは難しい「監視すべき対象」に自動的にリソースを集中できる。
  - 代表的な研究では、
    - AoI単独最小化よりも **平均システム損失（L-条件付き交差エントロピーベース）を有意に低減**。

---

## 2.3 早期終了と適応的オフローディング

- **多出口DNN / BranchyNet系**
  - 中間層出口での `S_conf` または `H` を用いて、
    - 高信頼なら**浅い層で打ち切り**（計算＋通信コストを削減）。
    - 低信頼なら深層まで計算 or クラウドオフロード。

- **Cloud-Edge協調LLM（例: 小型SLM + クラウドLLM）**
  - エッジ側の小型モデルがトークンを生成し、各トークンの信頼度を監視。
  - `S_conf ≥ τ` ならそのまま採用（クラウド送信なし）。
  - `S_conf < τ` が続く場合、**コンテキスト（隠れ状態）をクラウドにアップロード**し、大モデルに引き継ぎ。
  - 閾値 τ は、チャネル帯域やRTTに応じて動的調整される例もあり、
    - 通信が高コストな場合は τ を下げてエッジ完結を優先。
    - 通信が安価な場合は τ を上げてクラウド精度を優先。

---

# 3. BLEプロトコル上での実装詳細

## 3.1 Connection Parameter Update Request による接続間隔制御

- **標準メカニズム**
  - BLE接続中、Peripheral（エッジデバイス）は L2CAP の **Connection Parameter Update Request** を通じて、
    - `conn_interval_min/max`（例: 6=7.5 ms〜3200=4 s）、`slave_latency` 等の変更を要求可能。
  - 不確実性に応じた典型的な制御:
    - 高不確実 / 異常兆候 → `conn_interval ≈ 7.5–30 ms`、`slave_latency ≈ 0`。
    - 安定 / 低不確実 → `conn_interval ≈ 数百〜4000 ms`、`slave_latency` を増やし実質的なスリープを延長。

- **OSスタックの制約と回避策**
  - Android / iOS の BLE スタックは、
    - Peripheral からの更新要求を無視・制限する場合がある。
  - 代表的な回避策:
    - **Smart Duty Cycling**
      - 接続間隔自体は比較的短め（例: 30 ms）に固定。
      - 不確実性が低く送信不要なときは **Empty PDU** のみ送信（実データを抑制）。
    - **Slave Latency の活用**
      - 複数回のポーリングをスキップしても接続維持が許されるよう設定し、**平均Radio-on時間を削減**。

---

## 3.2 パケット単位の送信電力制御

- **メカニズム**
  - Nordic nRF52、ST BlueNRG 等のBLE SoC は、
    - API 経由で**パケット単位の TxPower 切替**をサポート。
  - 制御例:
    - 通常テレメトリ: `TxPower = -20 dBm`（低電力で到達性はそこそこ）。
    - 高リスク・高不確実なアラート: `TxPower = +4〜+20 dBm`（最大の到達率を確保）。

- **不確実性との連携**
  - 条件例:
    - `U高` かつ リスククラス=「転倒/心不全疑い」 → TxPower 最大。
    - `U低` かつ 状態=「安定/低リスク」 → TxPower 最小 or 送信スキップ。
  - 実験では、
    - 重要度クラスごとに TxPower と接続間隔を組み合わせることで、
    - **平均消費電力を削減しつつ、重大イベントの到達率はほぼ100%を維持**した報告がある。

---

# 4. リスク指標とセマンティック通信的アプローチ

## 4.1 L-条件付き交差エントロピーと「沈黙のコスト」

- **課題**
  - 単純な AoI（最後の更新からの経過時間）は、「何を見逃しているか」の重みを考慮しない。
  - エッジでは、「送信しないことによるリスク」を定量化する必要がある。

- **L-条件付き交差エントロピー H_L のアイデア**
  - 古い情報 `X_{t-δ}` に基づく推定 `Ŷ_t` が、真の状態 `Y_t` からどれだけズレているかを、
    - 損失関数 `L(Y_t, Ŷ_t)` で重み付けした期待値として定義。
  - 特徴:
    - **リスク非対称性**を表現できる。
      - 異常を見逃す False Negative は非常に大きな損失。
      - 誤警報 False Positive は相対的に小さな損失。

- **通信制御への利用**
  - ノードごとに H_L を評価し、
    - H_L が閾値を超えたときのみ送信（＝沈黙のコストが大きくなったタイミングで通信）。
  - RMABの **ゲイン・インデックス g_n** は、送信による H_L の減少量として定義される例もあり、
    - 「どのノードの沈黙を破るべきか」を理論的に決定できる。

---

## 4.2 セマンティック通信とエッジAI

- **セマンティックシンボル送信**
  - 生データではなく、エンコーダDNNが抽出した特徴ベクトル（意味的シンボル）を送信。
  - デコーダ側は多少のビット誤りがあっても文脈から復元できるため、
    - 再送を減らしつつ、**意味情報の正確性**を維持。

- **不確実性との連携**
  - 受信側デコーダの不確実性が高い場合のみ、
    - **追加のパリティ / 再送要求 / コンテキスト追加送信**を行うハイブリッドARQが提案されている。
  - これにより、
    - 「意味が曖昧になった場合だけ追加コストを払う」形の通信が実現可能。

---

# 5. 代表的ケーススタディ（結果のみ）

以下は、不確実性駆動制御がどの程度の効果を示したかを具体的に報告している代表的事例の要約である。

- **Case 1: モバイルエッジ学習（MEL）におけるタスク割当**
  - プラットフォーム: Jetson Nano 等のエッジGPUクラスタ。
  - 手法: デバイス能力の不確実性を考慮した MED (Minimum Expected Delay) スキーム。
  - 結果:
    - 学習完了時間を **最大 ≈11%短縮**。
    - データドロップ率（送信失敗・間に合わない通信）を **最大 ≈42%削減**。

- **Case 2: ウェアラブルデバイスのBLE電力最適化（FLC + PSO）**
  - プラットフォーム: 心拍モニタ等のBLEウェアラブル。
  - 手法:
    - 不確実性・バッテリ・RSSI を入力とするファジィ論理制御。
    - メンバーシップ関数を PSO で最適化。
  - 結果:
    - 静的なBLE設定と比較して、消費電力 **25–45%削減**。
    - QoS（到達率/有効サンプル率）を **95%以上** で維持。
    - 重要でない期間の **Radio-on duty を ≈1%未満** に抑制。

- **Case 3: 視覚オドメトリにおけるワンパス不確実性＋決定保留**
  - プラットフォーム: 自律移動ロボットのオンボードGPU。
  - 手法:
    - ワンパス不確実性推定により、位置推定が不確実なフレームのみクラウド or 人手へエスカレーション。
  - 結果:
    - ベースライン比で **エネルギー消費最大 ≈28倍削減**。
    - 位置推定精度は、クラウド協調運用により目標値を維持。

- **Case 4: LLMオフローディングにおける信頼度駆動コンテキストアップロード**
  - プラットフォーム: エッジ上の小型LLM + クラウドLLM。
  - 手法:
    - トークンごとの信頼度スコアが閾値を下回り始めた段階で、
      - **バックグラウンドで隠れ状態（コンテキスト）をクラウドに送信**。
      - 実際のオフロード時には既にコンテキストが同期済み → ユーザ体験の「寸断」を回避。
  - 結果:
    - オフロードのレイテンシをユーザが知覚しにくいレベルまで低減。
    - 通信量は、常時クラウド推論に対して大幅に削減（定量値は研究ごとに異なるが、おおむね数十%〜オーダー削減）。

---

本ノートは、ReFormHAR‑Tiny における **U/S/CCS→adv_interval 制御**や将来の **MAB/Safe‑MAB設計**に流用可能な要素（指標設計、制御ロジック、BLE実装、リスク指標）だけを抽出したものである。  
要件定義・設計書へ反映する場合は、ここから該当部分のみを引用し、フェーズごとの役割に応じて簡略化して用いる。 