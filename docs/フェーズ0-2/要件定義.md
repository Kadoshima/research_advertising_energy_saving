以下は、**フェーズ0-2（腰装着フォールバック）要件定義書**です。フェーズ1で定義した評価系を維持しつつ、高精度かつ安定した不確実度を短期間で確保するための保険レーンと追加伸びしろを整理します。

# フェーズ0-2 要件定義書（腰装着フォールバック）

**文書ID**: ReFormHAR‑Tiny/REQ‑PH0‑2‑v1.0  
**対象**: 腰装着データの迅速取得・学習および早期出口の評価  
**成功見込み**: 80–90%（腰データ）、60–70%（早期出口）

## 1. 目的
- 腰装着シナリオ向けに正解率（Accuracy）とバランス精度（Balanced Accuracy）≥0.90、期待較正誤差（Expected Calibration Error, ECE）≤0.03のHARモデルを短期間で確立し、BLE評価の母体を確保する。
- BLE安全バンディット評価を止めずに、腰データ版のU/S/CCSを供給し、フェーズ1のKPI算出を継続する。
- 余力がある場合は早期出口（Early-exit）構成を試験し、推論エネルギーとUの一貫性を改善する。

## 2. スコープと境界
- **腰ミニ計測**: 静止/歩行/走行/階段 × 各1分（計≈4分）、必要に応じて追加クラス（上下昇降等）。
- **代替データ**: 公開腰装着データセット（4–6クラス）を利用する場合はセンサ軸を合わせ、Runbookに出典・SHA256を記録。
- **モデル**: 小型1D-CNN（例: DS‑CNN 4–6クラス版）をゼロから学習、量子化（int8）、Arena ≤64 KB、t_inf ≤10 ms。
- **評価**: バランス精度（Balanced Accuracy）/マクロ平均F1スコア（F1 macro）、期待較正誤差（Expected Calibration Error, ECE）、未知率（Unknown rate）、Uの秩序性（易→低U、難→高U）を測定。
- **除外**: BLEチャネル集合変更、MAB導入、長期オンライン学習。

## 3. 成功指標と受入基準
- **正解率/バランス精度（Accuracy/Balanced Accuracy）**: Validationで≥0.90。
- **期待較正誤差（Expected Calibration Error, ECE）**: ≤0.03（温度スケーリング適用後）。
- **未知率（Unknown rate）**: 5–15%、秩序性テストで難クラス時のUが閾値を超過。
- **BLE指標**: フェーズ0-0の擬似U/S比較で期限超過率（Pout, τ=1/2/3 s）が同等以内、平均電流は腰モデルでも削減効果が維持。
- **早期出口（任意）**: 平均t_infを≥10%削減し、マクロ平均F1スコア（F1 macro）低下≤1.0 pt、Pout(1 s)/TL p95に悪化なし。

## 4. 主な作業レーン
1. 計測/データ収集: ミニセッション撮影、姿勢・装着位置の記録、センサ校正ログ取得。
2. 学習: 小型CNNで学習→被験者内/被験者間評価→量子化→Arena/t_inf計測。
3. 較正: 温度スケーリングでECE ≤0.03に合わせ、Unknown閾値τを適合率-再現率曲線（Precision-Recall, PR）から決定。
4. BLE統合: HarOut（腰モデル）をフェーズ1 Policy Engineへ供給し、Pout・TL・電力を評価。
5. 余力（レーン3）: 多出口CNN＋出力ブロック予測器を試験し、推論エネルギー削減とUの階調改善を観測。

## 5. 成果物
- データ取得メモ（環境、姿勢、収録時刻、端末設定）、公開データ利用時は出典・バージョン・SHA256。
- 腰モデル仕様書（アーキテクチャ、パラメタ数、Arena、t_inf、量子化情報）。
- 評価レポート（正解率/バランス精度, Accuracy/Balanced Accuracy／マクロ平均F1スコア, F1 macro／期待較正誤差, Expected Calibration Error／未知挙動／U秩序性／可視化：混同行列・TL/Pout比較）。
- 早期出口検証ノート（ON/OFF比較、エネルギー/レイテンシ差分、閾値設定）。

## 6. リスクと緩和
- **3分計測の品質不足** → 被験者2名以上・各条件≥1分を推奨、足りない場合は公開データで補完。
- **腰と胸のCCS差異** → ウィンドウパラメタとUnknown閾値を独立管理し、Runbookに両者の対照表を追加。
- **早期出口の不安定化** → Exit判定をHAR出力後移動平均で平滑、Uが暴発する場合はExit無効化でフォールバック。

## 7. フェーズ1との接続
- BLE評価系、ログスキーマ、KPI算出はフェーズ1の要件・設計文書をそのまま利用する。
- フェーズ0-2の成果でバランス精度（Balanced Accuracy）≥0.90、期待較正誤差（Expected Calibration Error, ECE）≤0.03を達成した場合、フェーズ1のFR‑2/FR‑5を腰モデルで先行検証できる。
- フェーズ0-1の準備が完了したら、本フェーズで得た腰モデルは比較ベースラインとして保持し、MAB導入時の安全側アーム生成に活用する。
